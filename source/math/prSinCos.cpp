/**
 * prSinCos.cpp
 *
 *  Copyright 2014 Paul Michael McNab
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */


#include "prSinCos.h"
#include "../core/prMacros.h"
#include "../debug/prTrace.h"


/// -----------------------------------------------------------------------------------------------
/// Lookup table.
/// -----------------------------------------------------------------------------------------------
static const double sinTable[] =
{
    0.000000, 0.479426, 0.841471, 0.997495, 0.909297, 0.598472, 0.141120, -0.350783, -0.756802, 
    -0.977530, -0.958924, -0.705540, -0.279415, 0.215120, 0.656987, 0.938000, 0.989358, 0.798487, 
    0.412118, -0.075151, -0.544021, -0.879696, -0.999990, -0.875452, -0.536573, -0.066322, 0.420167, 
    0.803784, 0.990607, 0.934895, 0.650288, 0.206467, -0.287903, -0.711785, -0.961397, -0.975626, 
    -0.750987, -0.342481, 0.149877, 0.605540, 0.912945, 0.996830, 0.836656, 0.471639, -0.008851, 
    -0.487175, -0.846220, -0.998082, -0.905578, -0.591358, -0.132352, 0.359058, 0.762558, 0.979358, 
    0.956376, 0.699240, 0.270906, -0.223756, -0.663634, -0.941031, -0.988032, -0.793127, -0.404038, 
    0.083974, 0.551427, 0.883870, 0.999912, 0.871140, 0.529083, 0.057487, -0.428183, -0.809019, 
    -0.991779, -0.931717, -0.643538, -0.197799, 0.296369, 0.717975, 0.963795, 0.973645, 0.745113, 
    0.334151, -0.158623, -0.612560, -0.916522, -0.996086, -0.831775, -0.463816, 0.017702, 0.494885, 
    0.850904, 0.998591, 0.901788, 0.584197, 0.123573, -0.367305, -0.768255, -0.981108, -0.953753, 
    -0.692885, -0.262375, 0.232374, 0.670229, 0.943989, 0.986628, 0.787705, 0.395925, -0.092791, 
    -0.558789, -0.887976, -0.999755, -0.866760, -0.521551, -0.048649, 0.436165, 0.814190, 0.992873, 
    0.928466, 0.636738, 0.189115, -0.304811, -0.724108, -0.966118, -0.971589, -0.739181, -0.325796, 
    0.167356, 0.619532, 0.920026, 0.995265, 0.826829, 0.455956, -0.026551, -0.502557, -0.855520, 
    -0.999021, -0.897928, -0.576990, -0.114785, 0.375524, 0.773891, 0.982782, 0.951055, 0.686476, 
    0.253823, -0.240974, -0.676772, -0.946873, -0.985146, -0.782221, -0.387782, 0.101601, 0.566108, 
    0.892012, 0.999520, 0.862311, 0.513978, 0.039806, -0.444113, -0.819297, -0.993889, -0.925142, 
    -0.629888, -0.180416, 0.313229, 0.730184, 0.968364, 0.969456, 0.733190, 0.317414, -0.176076, 
    -0.626456, -0.923458, -0.994366, -0.821818, -0.448060, 0.035398, 0.510190, 0.860069, 0.999374, 
    0.893997, 0.569738, 0.105988, -0.383712, -0.779466, -0.984379, -0.948282, -0.680012, -0.245252, 
    0.249555, 0.683262, 0.949682, 0.983588, 0.776676, 0.379608, -0.110402, -0.573382, -0.895978, 
    -0.999207, -0.857795, -0.506366, -0.030960, 0.452026, 0.824340, 0.994827, 0.921745, 0.622989, 
    0.171702, -0.321622, -0.736203, -0.970535, -0.967247, -0.727143, -0.309008, 0.184782, 0.633331, 
    0.926818, 0.993389, 0.816743, 0.440129, -0.044243, -0.517783, -0.864551, -0.999648, -0.889996, 
    -0.562441, -0.097182, 0.391871, 0.784980, 0.985899, 0.945435, 0.673496, 0.236661, -0.258116, 
    -0.689698, -0.952418, -0.981952, -0.771071, -0.371404, 0.119195, 0.580611, 0.899873, 0.998815, 
    0.853212, 0.498713, 0.022112, -0.459903, -0.829318, -0.995687, -0.918277, -0.616040, -0.162976, 
    0.329991, 0.742164, 0.972630, 0.964962, 0.721038, 0.300578, -0.193473, -0.640156, -0.930106, 
    -0.992334, -0.811603, -0.432164, 0.053084, 0.525335, 0.868966, 0.999844, 0.885925, 0.555101, 
    0.088369, -0.399999, -0.790433, -0.987342, -0.942514, -0.666927, -0.228052, 0.266657, 0.696080, 
    0.955078, 0.980240, 0.765404, 0.363171, -0.127979, -0.587795, -0.903699, -0.998345, -0.848562, 
    -0.491022, -0.013262, 0.467745, 0.834232, 0.996469, 0.914736, 0.609044, 0.154237, -0.338333, 
    -0.748068, -0.974649, -0.962602, -0.714876, -0.292124, 0.202150, 0.646931, 0.933321, 0.991201, 
    0.806401, 0.424165, -0.061920, -0.532846, -0.873312, -0.999961, -0.881785, -0.547717, -0.079549, 
    0.408096, 0.795824, 0.988707, 0.939520, 0.660305, 0.219425, -0.275178, -0.702408, -0.957664, 
    -0.978450, -0.759678, -0.354910, 0.136752, 0.594933, 0.907453, 0.997797, 0.843846, 0.483292, 
    0.004411, -0.475550, -0.839080, -0.997173, -0.911124, -0.602000, -0.145485, 0.346649, 0.753912, 
    0.976591, 0.960166, 0.708659, 0.283648, -0.210811, -0.653655, -0.936462, -0.989990, -0.801135, 
    -0.416133, 0.070752, 0.540315, 0.877590, 1.000000, 0.877575, 0.540290, 0.070722, -0.416161, 
    -0.801153, -0.989995, -0.936451, -0.653632, -0.210781, 0.283677, 0.708680, 0.960175, 0.976584, 
    0.753892, 0.346621, -0.145515, -0.602024, -0.911136, -0.997171, -0.839063, -0.475524, 0.004441, 
    0.483318, 0.843862, 0.997799, 0.907440, 0.594909, 0.136722, -0.354938, -0.759698, -0.978457, 
    -0.957655, -0.702386, -0.275149, 0.219455, 0.660328, 0.939530, 0.988702, 0.795806, 0.408068, 
    -0.079579, -0.547742, -0.881799, -0.999961, -0.873297, -0.532820, -0.061890, 0.424193, 0.806418, 
    0.991205, 0.933310, 0.646908, 0.202120, -0.292153, -0.714898, -0.962610, -0.974642, -0.748048, 
    -0.338305, 0.154266, 0.609068, 0.914748, 0.996467, 0.834215, 0.467719, -0.013292, -0.491048, 
    -0.848578, -0.998347, -0.903686, -0.587771, -0.127949, 0.363199, 0.765424, 0.980246, 0.955069, 
    0.696059, 0.266628, -0.228082, -0.666949, -0.942525, -0.987337, -0.790415, -0.399972, 0.088399, 
    0.555126, 0.885939, 0.999843, 0.868951, 0.525309, 0.053053, -0.432192, -0.811621, -0.992337, 
    -0.930095, -0.640133, -0.193444, 0.300607, 0.721059, 0.964970, 0.972623, 0.742144, 0.329962, 
    -0.163006, -0.616064, -0.918289, -0.995684, -0.829301, -0.459877, 0.022142, 0.498739, 0.853228, 
    0.998817, 0.899860, 0.580587, 0.119165, -0.371432, -0.771090, -0.981958, -0.952408, -0.689676, 
    -0.258087, 0.236691, 0.673518, 0.945445, 0.985894, 0.784962, 0.391843, -0.097212, -0.562466, 
    -0.890009, -0.999647, -0.864536, -0.517757, -0.044213, 0.440157, 0.816760, 0.993392, 0.926807, 
    0.633308, 0.184752, -0.309037, -0.727163, -0.967254, -0.970528, -0.736183, -0.321594, 0.171732, 
    0.623012, 0.921757, 0.994824, 0.824323, 0.451999, -0.030990, -0.506392, -0.857811, -0.999208, 
    -0.895964, -0.573357, -0.110372, 0.379636, 0.776695, 0.983593, 0.949673, 0.683240, 0.249526, 
    -0.245281, -0.680035, -0.948292, -0.984374, -0.779447, -0.383685, 0.106017, 0.569763, 0.894010, 
    0.999373, 0.860054, 0.510164, 0.035368, -0.448087, -0.821835, -0.994369, -0.923447, -0.626433, 
    -0.176046, 0.317443, 0.733211, 0.969463, 0.968357, 0.730163, 0.313200, -0.180445, -0.629911, 
    -0.925153, -0.993885, -0.819280, -0.444086, 0.039836, 0.514004, 0.862327, 0.999521, 0.891998, 
    0.566083, 0.101571, -0.387809, -0.782240, -0.985151, -0.946863, -0.676750, -0.240944, 0.253853, 
    0.686498, 0.951064, 0.982777, 0.773872, 0.375496, -0.114815, -0.577015, -0.897941, -0.999020, 
    -0.855504, -0.502531, -0.026521, 0.455983, 0.826846, 0.995268, 0.920014, 0.619509, 0.167326, 
    -0.325824, -0.739201, -0.971596, -0.966110, -0.724087, -0.304782, 0.189144, 0.636761, 0.928477, 
    0.992869, 0.814172, 0.436138, -0.048679, -0.521577, -0.866775, -0.999756, -0.887962, -0.558764, 
    -0.092761, 0.395953, 0.787724, 0.986633, 0.943979, 0.670207, 0.232344, -0.262404, -0.692907, 
    -0.953762, -0.981103, -0.768235, -0.367277, 0.123603, 0.584221, 0.901801, 0.998589, 0.850888, 
    0.494859, 0.017672, -0.463842, -0.831791, -0.996089, -0.916510, -0.612536, -0.158593, 0.334180, 
    0.745133, 0.973652, 0.963787, 0.717954, 0.296340, -0.197828, -0.643561, -0.931728, -0.991775, 
    -0.809001, -0.428155, 0.057518, 0.529108, 0.871155, 0.999912, 0.883856, 0.551402, 0.083944, 
    -0.404065, -0.793146, -0.988036, -0.941021, -0.663611, -0.223726, 0.270935, 0.699262, 0.956385, 
    0.979352, 0.762539, 0.359030, -0.132382, -0.591382, -0.905591, -0.998080, -0.846204, -0.487148, 
    -0.008821, 0.471666, 0.836672, 0.996832, 0.912933, 0.605516, 0.149847, -0.342509, -0.751007, 
    -0.975633, -0.961389, -0.711764, -0.287874, 0.206497, 0.650311, 0.934906, 0.990603, 0.803766, 
    0.420140, -0.066352, -0.536598, -0.875467, -0.999990, -0.879681, -0.543996, -0.075121, 0.412146, 
    0.798505, 0.989363, 0.937990, 0.656964, 0.215091, -0.279444, -0.705562, -0.958933, -0.977524, 
    -0.756783, -0.350755, 0.141150, 0.598496, 0.909310, 0.997493, 0.841455, 0.479399, -0.000030, 
    -0.479452, -0.841487, -0.997497, -0.909285, -0.598448, -0.141090, 0.350811, 0.756822, 0.977536, 
};


/// -----------------------------------------------------------------------------------------------
/// Lookup table.
/// -----------------------------------------------------------------------------------------------
static const double cosTable[] = 
{
    1.000000, 0.877583, 0.540302, 0.070737, -0.416147, -0.801144, -0.989992, -0.936457, -0.653644, 
    -0.210796, 0.283662, 0.708670, 0.960170, 0.976588, 0.753902, 0.346635, -0.145500, -0.602012, 
    -0.911130, -0.997172, -0.839072, -0.475537, 0.004426, 0.483305, 0.843854, 0.997798, 0.907447, 
    0.594921, 0.136737, -0.354924, -0.759688, -0.978453, -0.957659, -0.702397, -0.275163, 0.219440, 
    0.660317, 0.939525, 0.988705, 0.795815, 0.408082, -0.079564, -0.547729, -0.881792, -0.999961, 
    -0.873305, -0.532833, -0.061905, 0.424179, 0.806409, 0.991203, 0.933315, 0.646919, 0.202135, 
    -0.292139, -0.714887, -0.962606, -0.974645, -0.748058, -0.338319, 0.154251, 0.609056, 0.914742, 
    0.996468, 0.834223, 0.467732, -0.013277, -0.491035, -0.848570, -0.998346, -0.903692, -0.587783, 
    -0.127964, 0.363185, 0.765414, 0.980243, 0.955074, 0.696069, 0.266643, -0.228067, -0.666938, 
    -0.942519, -0.987339, -0.790424, -0.399985, 0.088384, 0.555113, 0.885932, 0.999843, 0.868958, 
    0.525322, 0.053069, -0.432178, -0.811612, -0.992335, -0.930100, -0.640144, -0.193459, 0.300593, 
    0.721048, 0.964966, 0.972627, 0.742154, 0.329977, -0.162991, -0.616052, -0.918283, -0.995686, 
    -0.829310, -0.459890, 0.022127, 0.498726, 0.853220, 0.998816, 0.899867, 0.580599, 0.119180, 
    -0.371418, -0.771080, -0.981955, -0.952413, -0.689687, -0.258102, 0.236676, 0.673507, 0.945440, 
    0.985897, 0.784971, 0.391857, -0.097197, -0.562454, -0.890002, -0.999647, -0.864544, -0.517770, 
    -0.044228, 0.440143, 0.816751, 0.993390, 0.926813, 0.633319, 0.184767, -0.309023, -0.727153, 
    -0.967251, -0.970532, -0.736193, -0.321608, 0.171717, 0.623000, 0.921751, 0.994825, 0.824331, 
    0.452012, -0.030975, -0.506379, -0.857803, -0.999207, -0.895971, -0.573370, -0.110387, 0.379622, 
    0.776686, 0.983590, 0.949678, 0.683251, 0.249540, -0.245267, -0.680023, -0.948287, -0.984377, 
    -0.779457, -0.383698, 0.106003, 0.569750, 0.894003, 0.999373, 0.860062, 0.510177, 0.035383, 
    -0.448074, -0.821826, -0.994367, -0.923453, -0.626444, -0.176061, 0.317429, 0.733201, 0.969459, 
    0.968361, 0.730174, 0.313214, -0.180430, -0.629900, -0.925148, -0.993887, -0.819288, -0.444099, 
    0.039821, 0.513991, 0.862319, 0.999521, 0.892005, 0.566095, 0.101586, -0.387796, -0.782231, 
    -0.985149, -0.946868, -0.676761, -0.240959, 0.253838, 0.686487, 0.951059, 0.982780, 0.773881, 
    0.375510, -0.114800, -0.577002, -0.897934, -0.999021, -0.855512, -0.502544, -0.026536, 0.455969, 
    0.826837, 0.995267, 0.920020, 0.619521, 0.167341, -0.325810, -0.739191, -0.971592, -0.966114, 
    -0.724097, -0.304796, 0.189129, 0.636750, 0.928471, 0.992871, 0.814181, 0.436151, -0.048664, 
    -0.521564, -0.866767, -0.999756, -0.887969, -0.558777, -0.092776, 0.395939, 0.787715, 0.986630, 
    0.943984, 0.670218, 0.232359, -0.262389, -0.692896, -0.953757, -0.981106, -0.768245, -0.367291, 
    0.123588, 0.584209, 0.901795, 0.998590, 0.850896, 0.494872, 0.017687, -0.463829, -0.831783, 
    -0.996088, -0.916516, -0.612548, -0.158608, 0.334165, 0.745123, 0.973649, 0.963791, 0.717964, 
    0.296354, -0.197814, -0.643550, -0.931722, -0.991777, -0.809010, -0.428169, 0.057503, 0.529095, 
    0.871147, 0.999912, 0.883863, 0.551414, 0.083959, -0.404051, -0.793136, -0.988034, -0.941026, 
    -0.663623, -0.223741, 0.270920, 0.699251, 0.956380, 0.979355, 0.762549, 0.359044, -0.132367, 
    -0.591370, -0.905585, -0.998081, -0.846212, -0.487161, -0.008836, 0.471652, 0.836664, 0.996831, 
    0.912939, 0.605528, 0.149862, -0.342495, -0.750997, -0.975629, -0.961393, -0.711775, -0.287889, 
    0.206482, 0.650299, 0.934900, 0.990605, 0.803775, 0.420153, -0.066337, -0.536586, -0.875459, 
    -0.999990, -0.879689, -0.544008, -0.075136, 0.412132, 0.798496, 0.989360, 0.937995, 0.656975, 
    0.215105, -0.279430, -0.705551, -0.958929, -0.977527, -0.756793, -0.350769, 0.141135, 0.598484, 
    0.909304, 0.997494, 0.841463, 0.479412, -0.000015, -0.479439, -0.841479, -0.997496, -0.909291, 
    -0.598460, -0.141105, 0.350797, 0.756812, 0.977533, 0.958920, 0.705530, 0.279401, -0.215135, 
    -0.656998, -0.938005, -0.989356, -0.798478, -0.412105, 0.075166, 0.544034, 0.879703, 0.999990, 
    0.875445, 0.536560, 0.066307, -0.420181, -0.803793, -0.990609, -0.934890, -0.650276, -0.206453, 
    0.287918, 0.711796, 0.961402, 0.975623, 0.750977, 0.342466, -0.149892, -0.605552, -0.912951, 
    -0.996829, -0.836647, -0.471626, 0.008866, 0.487188, 0.846228, 0.998083, 0.905572, 0.591345, 
    0.132337, -0.359072, -0.762568, -0.979361, -0.956372, -0.699229, -0.270891, 0.223770, 0.663645, 
    0.941037, 0.988029, 0.793118, 0.404024, -0.083989, -0.551439, -0.883877, -0.999912, -0.871133, 
    -0.529070, -0.057472, 0.428196, 0.809028, 0.991781, 0.931711, 0.643527, 0.197784, -0.296383, 
    -0.717985, -0.963799, -0.973642, -0.745103, -0.334137, 0.158638, 0.612572, 0.916528, 0.996085, 
    0.831766, 0.463802, -0.017717, -0.494898, -0.850911, -0.998592, -0.901782, -0.584184, -0.123558, 
    0.367319, 0.768264, 0.981111, 0.953748, 0.692874, 0.262360, -0.232388, -0.670240, -0.943994, 
    -0.986625, -0.787696, -0.395911, 0.092806, 0.558802, 0.887983, 0.999755, 0.866752, 0.521538, 
    0.048634, -0.436178, -0.814198, -0.992874, -0.928460, -0.636726, -0.189100, 0.304825, 0.724118, 
    0.966122, 0.971585, 0.739171, 0.325781, -0.167371, -0.619544, -0.920032, -0.995264, -0.826820, 
    -0.455942, 0.026566, 0.502570, 0.855528, 0.999022, 0.897921, 0.576978, 0.114770, -0.375538, 
    -0.773900, -0.982785, -0.951050, -0.686465, -0.253809, 0.240988, 0.676783, 0.946878, 0.985144, 
    0.782212, 0.387768, -0.101616, -0.566120, -0.892018, -0.999520, -0.862304, -0.513966, -0.039791, 
    0.444126, 0.819306, 0.993890, 0.925136, 0.629876, 0.180401, -0.313243, -0.730194, -0.968368, 
    -0.969452, -0.733180, -0.317400, 0.176090, 0.626468, 0.923464, 0.994364, 0.821809, 0.448047, 
    -0.035413, -0.510203, -0.860077, -0.999374, -0.893990, -0.569726, -0.105973, 0.383726, 0.779476, 
    0.984382, 0.948277, 0.680001, 0.245237, -0.249569, -0.683273, -0.949687, -0.983585, -0.776667, 
    -0.379594, 0.110417, 0.573394, 0.895984, 0.999206, 0.857788, 0.506353, 0.030945, -0.452039, 
    -0.824348, -0.994828, -0.921740, -0.622977, -0.171688, 0.321637, 0.736213, 0.970539, 0.967243, 
    0.727132, 0.308994, -0.184797, -0.633343, -0.926824, -0.993387, -0.816734, -0.440116, 0.044258, 
    0.517796, 0.864559, 0.999648, 0.889989, 0.562429, 0.097167, -0.391885, -0.784990, -0.985902, 
    -0.945430, -0.673485, -0.236647, 0.258131, 0.689709, 0.952422, 0.981949, 0.771061, 0.371390, 
    -0.119210, -0.580623, -0.899880, -0.998814, -0.853204, -0.498700, -0.022097, 0.459917, 0.829327, 
    0.995688, 0.918271, 0.616029, 0.162961, -0.330005, -0.742174, -0.972634, -0.964958, -0.721027, 
    -0.300564, 0.193488, 0.640167, 0.930111, 0.992332, 0.811595, 0.432151, -0.053099, -0.525348, 
    -0.868973, -0.999844, -0.885918, -0.555088, -0.088354, 0.400013, 0.790442, 0.987344, 0.942509, 
    0.666916, 0.228038, -0.266672, -0.696091, -0.955083, -0.980237, -0.765395, -0.363157, 0.127994, 
    0.587807, 0.903705, 0.998344, 0.848554, 0.491008, 0.013247, -0.467758, -0.834240, -0.996470, 
    -0.914730, -0.609032, -0.154222, 0.338348, 0.748078, 0.974652, 0.962598, 0.714866, 0.292110, 
    -0.202165, -0.646942, -0.933326, -0.991199, -0.806392, -0.424152, 0.061935, 0.532859, 0.873319, 
    0.999961, 0.881778, 0.547704, 0.079534, -0.408110, -0.795833, -0.988709, -0.939515, -0.660294, 
    -0.219411, 0.275192, 0.702419, 0.957668, 0.978447, 0.759668, 0.354896, -0.136767, -0.594945, 
    -0.907459, -0.997796, -0.843838, -0.483278, -0.004396, 0.475563, 0.839088, 0.997174, 0.911118, 
    0.601988, 0.145470, -0.346664, -0.753922, -0.976594, -0.960162, -0.708649, -0.283633, 0.210825, 
    0.653666, 0.936467, 0.989988, 0.801126, 0.416119, -0.070767, -0.540328, -0.877597, -1.000000, 
    -0.877568, -0.540277, -0.070707, 0.416174, 0.801162, 0.989997, 0.936446, 0.653621, 0.210766, 
};


/// -----------------------------------------------------------------------------------------------
/// Returns sine.
/// -----------------------------------------------------------------------------------------------
f32 prCos(u32 angle)
{
    if (angle > PRARRAY_SIZE(cosTable))
    {
        angle %= PRARRAY_SIZE(cosTable);
    }

    return (float)cosTable[angle];
}


/// -----------------------------------------------------------------------------------------------
/// Returns cosine.
/// -----------------------------------------------------------------------------------------------
f32 prSin(u32 angle)
{
    if (angle > PRARRAY_SIZE(sinTable))
    {
        angle %= PRARRAY_SIZE(sinTable);
    }

    return (float)sinTable[angle];
}
